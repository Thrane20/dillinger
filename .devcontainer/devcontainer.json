{
  "name": "Dillinger Dev Environment",
  "build": {
    "dockerfile": "Dockerfile", 
    "context": "..",
    "network": "host"
  },
  "features": {
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {},
    "ghcr.io/devcontainers/features/rust:1": {}
  },
  "remoteUser": "node",
  "runArgs": [
    "--init",
    "--network=host",
    "--ipc=host",
    "--memory=32g",
    "--memory-swap=40g",
    "--oom-score-adj=500",
    "--device=/dev/dri",
    "--device=/dev/snd",
    "--device=/dev/input",
    "--device=/dev/uinput",
    "--device=/dev/bus/usb"
  ],
  "mounts": [
    "source=dillinger_core,target=/data,type=volume",
    "source=dillinger_roms,target=/roms,type=volume",
    "source=dillinger_cache,target=/cache,type=volume",
    "source=dillinger_installed_dev,target=/installed/dev,type=volume",
    "source=dillinger-pnpm-store,target=/home/node/.local/share/pnpm/store,type=volume",
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind",
    "source=/tmp/.X11-unix,target=/tmp/.X11-unix,type=bind",
    "source=/run/user/1000,type=bind,target=/run/user/1000",
    "source=/run/udev,type=bind,target=/run/udev,readonly",
    "source=${localEnv:HOME}/.Xauthority,target=/home/node/.Xauthority,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.config/pulse,target=/home/node/.config/pulse,type=bind"
  ],
  "forwardPorts": [8080],
  "portsAttributes": {
    "8080": { "label": "Streaming/WebRTC" }
  },
  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash",
        "files.watcherExclude": {
          "**/node_modules": true,
          "**/.pnpm-store": true
        },
        "pnpm.enableRunFromMenu": true
      },
      "extensions": [
       
      ]
    }
  },
  "postCreateCommand": "pnpm install",
  "postStartCommand": "sudo chown -R $(id -u):$(id -g) /data /cache /installed /home/node/.local/share/pnpm/store 2>/dev/null || true && sudo chown root:docker /var/run/docker.sock && pnpm run build:shared",
  "containerEnv": {
    "PNPM_HOME": "/home/node/.local/share/pnpm",
    "DILLINGER_CORE_PATH": "/data",
    "PUID": "1000",
    "PGID": "1000",
    "DISPLAY": "${localEnv:DISPLAY}",
    "XDG_RUNTIME_DIR": "/run/user/1000",
    "WAYLAND_DISPLAY": "${localEnv:WAYLAND_DISPLAY}",
    "PULSE_SERVER": "unix:/run/user/1000/pulse/native"
  }
}
